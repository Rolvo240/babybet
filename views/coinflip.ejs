<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keeg eller ikke Keeg</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .coin-button {
      transform: translateY(0);
      transition: all 0.3s ease;
    }
    .coin-button:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .message {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .coin {
      width: 150px;
      height: 150px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 1s;
    }
    .coin-front, .coin-back {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
    }
    .coin-front {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      transform: rotateY(180deg);
    }
    .coin-back {
      background: linear-gradient(45deg, #C0C0C0, #808080);
    }
    .flipping {
      animation: flip 1s ease-in-out;
    }
    @keyframes flip {
      0% { transform: rotateY(0); }
      100% { transform: rotateY(1800deg); }
    }
    .win-message {
      animation: bounce 0.5s ease infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-purple-900 to-blue-900 text-white min-h-screen p-6">
  <div class="max-w-xl mx-auto">
    <div class="flex justify-between items-center mb-8">
      <a href="/casino/<%= userId %>" class="bg-white/10 hover:bg-white/20 p-3 rounded-full transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </a>
      <h1 class="text-4xl font-extrabold text-center">ðŸª™ Keeg eller Ikke Keeg</h1>
      <div class="w-10"></div>
    </div>

    <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-8">
      <p class="text-center text-2xl mb-2">Din Saldo</p>
      <p class="text-center text-4xl font-bold"><%= balance %> ðŸª™</p>
    </div>

    <% if (message) { %>
      <div class="message bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-8 text-center text-xl <%= message.includes('vant') ? 'win-message' : '' %>">
        <%= message %>
      </div>
    <% } %>

    <div id="coin" class="coin mx-auto mb-8">
      <div class="coin-front">ðŸ‘‘</div>
      <div class="coin-back">ðŸ’¤</div>
    </div>

    <form method="POST" class="grid grid-cols-2 gap-4" id="betForm">
      <input type="hidden" name="userId" value="<%= userId %>">
      <button type="button" name="guess" value="keeg" class="coin-button bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 p-6 rounded-xl text-center text-xl font-bold transition" onclick="flipCoin('keeg')">
        <div class="flex items-center justify-center gap-3">
          <span class="text-3xl">ðŸ‘‘</span>
          <span>Keeg</span>
        </div>
      </button>
      <button type="button" name="guess" value="ikke" class="coin-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 p-6 rounded-xl text-center text-xl font-bold transition" onclick="flipCoin('ikke')">
        <div class="flex items-center justify-center gap-3">
          <span class="text-3xl">ðŸ’¤</span>
          <span>Ikke Keeg</span>
        </div>
      </button>
    </form>
  </div>

  <audio id="flipSound" src="https://assets.mixkit.co/sfx/preview/mixkit-coin-win-notification-1992.mp3"></audio>
  <audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

  <script>
    function flipCoin(guess) {
      const coin = document.getElementById('coin');
      const flipSound = document.getElementById('flipSound');
      const winSound = document.getElementById('winSound');
      const form = document.getElementById('betForm');
      
      // Disable buttons during animation
      document.querySelectorAll('button').forEach(btn => btn.disabled = true);
      
      // Play flip sound
      flipSound.currentTime = 0;
      flipSound.play();
      
      // Add flipping animation
      coin.classList.add('flipping');
      
      // Submit form after animation
      setTimeout(() => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'guess';
        input.value = guess;
        form.appendChild(input);
        form.submit();
      }, 1000);
    }

    // Trigger confetti if there's a win message
    <% if (message && message.includes('vant')) { %>
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
      document.getElementById('winSound').play();
    <% } %>
  </script>
</body>
</html>
